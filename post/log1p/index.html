<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>log1p in Julia</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="generator" content="Hugo 0.26" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../css/lovelace.css">
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          displayMath: [['$$','$$'], ['\[','\]']],
          processEscapes: true,
          processEnvironments: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
          TeX: { equationNumbers: { autoNumber: "AMS" },
               extensions: ["AMSmath.js", "AMSsymbols.js"] }
        }
      });
    </script>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>
  <body>
    <nav id="navbar">
      <a href="http://tpapp.github.io/">About</a>
<a href="http://tpapp.github.io/research">Research</a>
<a href="http://tpapp.github.io/post">Blog</a>
<a href="http://tpapp.github.io/software">Software</a>
<a href="https://github.com/tpapp/">Github</a>

    </nav>
    <div id="navbarplaceholder">
      <a href="http://tpapp.github.io/">About</a>
<a href="http://tpapp.github.io/research">Research</a>
<a href="http://tpapp.github.io/post">Blog</a>
<a href="http://tpapp.github.io/software">Software</a>
<a href="https://github.com/tpapp/">Github</a>

    </div>
    <div id="mainbody">
<div id="sidebar">
  
  <a href="../../tags/bayesian">bayesian</a>
  
  <a href="../../tags/blogging">blogging</a>
  
  <a href="../../tags/browser-plugins">browser-plugins</a>
  
  <a href="../../tags/economics">economics</a>
  
  <a href="../../tags/emacs">emacs</a>
  
  <a href="../../tags/emacs-emacs25-ubuntu">emacs-emacs25-ubuntu</a>
  
  <a href="../../tags/firefox">firefox</a>
  
  <a href="../../tags/hugo">hugo</a>
  
  <a href="../../tags/jacobian">jacobian</a>
  
  <a href="../../tags/julia">julia</a>
  
  <a href="../../tags/latex">latex</a>
  
  <a href="../../tags/log1p">log1p</a>
  
  <a href="../../tags/math">math</a>
  
  <a href="../../tags/mcmc">mcmc</a>
  
  <a href="../../tags/my-packages">my-packages</a>
  
  <a href="../../tags/numerical-error">numerical-error</a>
  
  <a href="../../tags/numerical-methods">numerical-methods</a>
  
  <a href="../../tags/packages">packages</a>
  
  <a href="../../tags/stan">stan</a>
  
  <a href="../../tags/teaching">teaching</a>
  
  <a href="../../tags/tutorial">tutorial</a>
  
  <a href="../../tags/weave">weave</a>
  
</div>

<div id="content">
<h1>log1p in Julia</h1>2017/09/13
<span class="tags">
    
    <a href="../../tags/julia">julia</a>
    
    <a href="../../tags/log1p">log1p</a>
    
    <a href="../../tags/numerical-error">numerical error</a>
    
</span>



<p>This is a follow-up on a <a href="https://discourse.julialang.org/t/log1p-in-base-vs-base-math-julialibm/5852">question</a> I asked on the Julia forums about calculating
[
\text{log1p}(x) = log(1+x)
]
This calculation is tricky because if $x \approx 0$,
[
log(1+x) \approx x
]
while as $x \to \infty$, $\log(1+x)$ approaches $\log(x)$, so simply using <code>log(1+x)</code> will not be as accurate as it could be. Numerical analysts have developed specialized methods for these calculations that try to get an accurate answer, and all programming languages serious about numerical calculations have an implementation either in the core language or a library.</p>

<p>Julia&rsquo;s <code>Base.log1p</code> currently suggests that <code>Base.Math.JuliaLibm.log1p</code> would be preferable, but then I was wondering why isn&rsquo;t that the default? So I decided to perform a trivial numerical experiment, calculating the error for both.</p>

<p>The key question is what to compare the results with. One could compare to an existing &ldquo;gold standard&rdquo; implementation, or simply calculate the results using a higher precision representation. Fortunately, Julia has <code>BigFloat</code>s available right out of the box.</p>

<p>The graph below shows the base-2 logarithm of the <em>relative</em> error for <code>Base.log1p</code> vs $log_2(1+x)$; horizontal lines are <code>log2(eps())</code> and <code>log2(eps())+1</code>. This suggests that <code>Base.log1p</code> is <em>very accurate</em>, but not as good as it could be when $x \approx 0$.</p>

<p><img src="Base_log1p_error.svg" style="width:40em"></p>

<p>The next plot shows the relative accuracy of the relative error above, comparing <code>Base.Math.JuliaLibm.log1p</code> to <code>Base.log1p</code> (lower values better). In these simulations, <code>Base.Math.JuliaLibm.log1p</code> is never worse, but sometimes significantly better (resulting in an extra digit of accuracy). This matters especially when $x \approx 0$.</p>

<p><img src="JuliaLibm_improvement.svg" style="width:40em"></p>

<p>The next plot confirms this.</p>

<p><img src="JuliaLibm_log1p_error.svg" style="width:40em"></p>

<p><strong>Conclusion</strong>: <code>Base.Math.JuliaLibm.log1p</code> is more accurate and should be the default method.</p>

<p>Code is available below.</p>

<script src="//gist.github.com/tpapp/3d7272cae2574d413991dc4648fcda6e.js"></script>



<div id="pagenav">
  
  <span class="pagenav-label">Previous</span>
  <a href="http://tpapp.github.io/post/emacs-julia-customizations/">Emacs customizations for julia-mode</a>
  
  
</div>

<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tpappgithubio" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    </div>
  </body>
</html>

